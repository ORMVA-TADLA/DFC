<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6">
    <meta name="description" content="Offline data collection app with GPS, photos, and local storage">
    <title>Data Field Collector</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="app">
        <!-- Form View -->
        <div id="form-view" class="container">
            <div class="header">
                <div>
                    <h1>Data Field Collector</h1>
                </div>
                <button id="view-entries-btn" class="btn btn-secondary">
                    <span class="icon">üìò</span>
                    <span>View (<span id="entry-count">0</span>)</span>
                </button>
            </div>

            <!-- Loading Indicator -->
            <div id="loading-indicator" class="alert alert-info" style="display: none;">
                <div class="loading-spinner"></div>
                Processing...
            </div>

            <!-- Auto-save Indicator -->
            <div id="autosave-indicator" class="alert alert-success" style="display: none;">
                <div class="autosave-dot"></div>
                <span>Draft auto-saved</span>
                <span id="autosave-time" class="time"></span>
            </div>

            <!-- Form -->
            <div class="form-card">
                <div class="form-group">
                    <label>Secondaire *</label>
                    <select id="secondaire" autocomplete="off">
                        <option value="">Select Secondaire</option>
                        <option value="SG8">SG8</option>
                        <option value="SG8A">SG8A</option>
                        <option value="SG8B">SG8B</option>
                        <option value="SG9">SG9</option>
                        <option value="SG9A">SG9A</option>
                        <option value="SG9B">SG9B</option>
                        <option value="SG10">SG10</option>
                        <option value="SG10A">SG10A</option>
                        <option value="SG10B">SG10B</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tertiaire *</label>
                    <select id="tertiaire" autocomplete="off">
                        <option value="">Select Tertiaire</option>
                        <option value="TG1">TG1</option>
                        <option value="TG2">TG2</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>2eme Tertiaire (optionaly)</label>
                    <select id="tertiaire_2" autocomplete="off">
                        <option value="">Select 2eme Tertiaire</option>
                        <option value="TG1">TG1</option>
                        <option value="TG2">TG2</option>
                    </select>
                </div>

                <div class="form-grid">
                    <div class="form-grid-item">
                        <label>Elements to change</label>
                        <input type="number" id="elementsChange" value="0" step="1" min="0">
                    </div>

                    <div class="form-grid-item">
                        <label>Bagues to change</label>
                        <input type="number" id="baguesChange" value="0" step="1" min="0">
                    </div>

                    <div class="form-grid-item">
                        <label>Supports to change</label>
                        <input type="number" id="supportsChange" value="0" step="1" min="0">
                    </div>

                    <div class="form-grid-item">
                        <label>Remise en place</label>
                        <input type="number" id="remise" value="0" step="1" min="0">
                    </div>
                </div>

                <div class="form-group">
                    <label>Observation</label>
                    <textarea id="observation" rows="3"
                        placeholder="Enter detailed observations, or comments..."></textarea>
                </div>

                <div class="button-group">
                    <button id="get-location-btn" class="btn btn-grey">
                        <span class="icon">üìç</span>
                        <span id="location-text">Get GPS</span>
                    </button>
                    <label for="photo-input" class="btn btn-grey">
                        <span class="icon">üì∑</span>
                        <span>Photos (<span id="photo-count">0</span>)</span>
                    </label>
                    <input type="file" id="photo-input" accept="image/*" multiple capture="environment"
                        style="display: none;">
                </div>

                <!-- Photo Preview -->
                <div id="photo-preview" class="photo-preview" style="display: none;">
                    <div class="preview-header">
                        <span>Photo Preview (<span id="preview-count">0</span>)</span>
                        <span id="preview-size" class="preview-size"></span>
                    </div>
                    <div id="preview-grid" class="preview-grid"></div>
                </div>

                <button id="save-entry-btn" class="btn btn-save" onclick="saveEntry()">
                    <span class="icon">üíæ</span>
                    Save to Database
                </button>
            </div>

            <!-- <div class="info-card">
                <div class="info-icon">üíæ</div>
                <div>
                    <p class="info-title">‚ú® Enhanced with IndexedDB</p>
                    <p class="info-text">Stores unlimited photos locally ‚Ä¢ Works 100% offline ‚Ä¢ GPS location tracking ‚Ä¢
                        No internet required</p>
                </div>
            </div> -->
        </div>

        <!-- List View -->
        <div id="list-view" class="container" style="display: none;">
            <div class="header">
                <div>
                    <h1>Saved Entries</h1>
                    <p class="subtitle">Total: <span id="total-entries">0</span> entries</p>
                </div>
                <button id="new-entry-btn" class="btn btn-primary">
                    <span class="icon">‚ûï</span>
                    New Entry
                </button>
            </div>

            <!-- Storage Info -->
            <div id="storage-info" class="storage-card">
                <div class="storage-header">
                    <span class="icon">üíæ</span>
                    <span class="storage-title">Storage Usage</span>
                </div>
                <div id="storage-text" class="storage-text"></div>
                <div class="storage-bar">
                    <div id="storage-progress" class="storage-progress"></div>
                </div>
            </div>

            <!-- Entries List -->
            <div id="entries-list"></div>

            <!-- Empty State -->
            <div id="empty-state" class="empty-state" style="display: none;">
                <div class="empty-icon">üíæ</div>
                <p>No entries yet. Create your first entry!</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="db.js"></script>
    <script src="app.js"></script>
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed:', err));
            });
        }
    </script>
</body>

</html>
